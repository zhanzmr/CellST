#' Gene expression in each cell lineage trajectory
#'
#' @description \code{trajectory_expression()} returns a list containing gene expression
#' of each cell lineage trajectory.
#' @param data a dataframe with \eqn{N*t} rows and \eqn{d+2} columns, where \eqn{N} is
#' the number of cells in one time point(the number of cells need to be equal
#' among different time points),
#' \eqn{t} is the number of time points, \eqn{d} is the number of genes. The first column
#' is the cell names and the last column is the time points which contains continuous
#' integers beginning from 1. The column names of the first and the last columns need to be set as
#' 'index' and 'time', respectively.
#' This dataframe could be regraded as a result of \code{rbind()} of cell-gene
#' dataset ordered by \emph{increasing} time points.
#' @param cell_name_traj a dataframe with \eqn{N} rows and \eqn{t} columns, giving \eqn{N} unique
#' trajectories for individual cells, each trajectory has length \eqn{t}. This dataframe could be
#' generated by function \code{\link{cell_name_traj}}.
#'
#' @return a list of length \eqn{N}. The \eqn{i}-th element in the list is a matrix with
#' \eqn{d} rows and \eqn{t} columns, giving the gene expression of \eqn{d} genes in \eqn{t} time
#' points of the \eqn{i}-th cell lineage trajectory.
#'
#' @export
#'

trajectory_expression <- function(data,cell_name_traj){
  trajectory_expression1 = list()
  N = length(cell_name_traj[,1])
  pb <- progress_bar$new(
   format = 'Processing [:bar] :percent eta: :eta',
   total = N, clear = FALSE, width = 80)
  t = dim(cell_name_traj)[2]
  for (row in 1:N){
    pb$tick()
    #Sys.sleep(0.0005)
    row_num = row
    name = as.character(cell_name_traj[row_num,1])
    value = as.numeric(t(data[data$index == name,]))
    value = value[c(2:(length(value)-1))]
    gene_value = as.data.frame(value)

    for (nn in 2:t){
      name = as.character(cell_name_traj[row_num,nn])
      value = as.numeric(t(data[data$index == name,]))
      value = value[c(2:(length(value)-1))]
      value = as.data.frame(value)
      gene_value = cbind(gene_value,value)
    }

    gga = as.matrix(gene_value)
    colnames(gga) = paste0("time_", seq(1:t))
    rownames(gga) = gene_name
    trajectory_expression1[[row]] = gga
    #print(row)
  }
  return(trajectory_expression1)
}






